afGuard plugin
==============

This plugin was born from sfGuardPlugin.
It is modified to be compatible for applications using AppFlowerPlugin.

What you need to use it ?

Your symfony application should have AppFlowerPlugin already installed.
Next you should install afGuardPlugin in your project - you can just copy its
files or clone git repository from github git://github.com/appflower/afGuardPlugin.git

As always you should rebuild model and sql, running:
./symfony propel:build-model
./symfony propel:build-sql
./symfony cc

Now you should initiate proper database structure with (thiw will delete all your data:O):
./symfony propel:insert-sql

Make your application secure with apps/frontend/config/security.yml like:
default:
  is_secure: true

Change settings.yml like:
all:
  .settings:
    .enabled_modules: [default, ..., afGuardAuth]
  .actions:
    login_module: afGuardAuth
    login_action: signin
    secure_module: afGuardAuth
    secure_action: insufficientCredentials


Make sure that you ProjectConfiguration class implements AppFlowerApplication interface correctly.
If you use Propel 1.6 you can do it by adding following method to configuration class:
   function getAppFlowerUserQuery()
   {
      return afGuardUserQuery::create();
   }

Change you apps/frontend/lib/myUser.class.php to extend afGuardSecurityUser instead of sfBasicSecurityUser

You should also change implementation of AppFlowerSecurityUser interface. Since
you have already installed AppFlowerPlugin before you probably have myUser::getAppflowerUser() method like below:

    public function getAppFlowerUser()
    {
        return new AppFlowerAnonymousUser;
    }

You should change it to:

    public function getAppFlowerUser()
    {
        return $this->getGuardUser();
    }


You can also enable (in settings.yml) more modules like: afGuardUser, afGuardGroup to manage users and groups through AF interface.
all:
  .settings:
    .enabled_modules: [defaul, ..., afGuardAuth, afGuardUser, afGuardGroup]

After this you can access them using url: http://yourapp/#/afGuardUser/list


Finally if you want to use "remember me" functionality change security filer in your apps/frontend/config/filters.yml:
security:
  class: afGuardBasicSecurityFilter

Another feature you might want to use is captcha.
You just need to install sfCaptchaPlugin (from AppFlower repository). After this when user fails to log in few times - captcha files will be added to login form to protect against brute force login attacks.
Captcha feature is using APC
